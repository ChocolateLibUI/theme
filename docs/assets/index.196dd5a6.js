var j=Object.defineProperty;var K=(s,t,e)=>t in s?j(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(K(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const V="@chocolatelibui/theme";let G=(s,t)=>{var i;let e=new TextEncoder().encode(s);return s=new TextDecoder().decode(e.slice(0,t)),((i=s.at(-1))==null?void 0:i.charCodeAt(0))===65533?s.slice(0,-1):s};class v{constructor(t){o(this,"___valueListeners",[]);o(this,"___value");o(this,"info");this.___value=t}addListener(t,e){if(this.___valueListeners.push(t),e){let i=this.get;i instanceof Promise?i.then(t):t(i)}return t}removeListener(t){let e=this.___valueListeners.indexOf(t);return e!=-1&&this.___valueListeners.splice(e,1),t}get get(){return this.___value}set set(t){this.___value!==t&&(this.___value=t,this.___update())}___update(){if(this.___valueListeners)for(let t=0,e=this.___valueListeners.length;t<e;t++)try{this.___valueListeners[t](this.___value)}catch(i){console.warn("Failed while calling value listeners ",i)}}compare(t){let e=this.get;return e instanceof Promise?e.then(i=>t!==i):t!==e}get inUse(){return this.___valueListeners.length!==0}hasListener(t){return this.___valueListeners.indexOf(t)!==-1}toJSON(){return this.___value}}class J extends v{constructor(e,i){super(e);o(this,"___limiters");o(this,"___limitersListeners",[]);this.___limiters=i}addLimiterListener(e,i){return this.___limitersListeners.push(e),i&&e(this),e}removeLimiterListener(e){let i=this.___limitersListeners.indexOf(e);return i!=-1&&this.___limitersListeners.splice(i,1),e}___updateLimiter(){if(this.___limitersListeners)for(let e=0,i=this.___limitersListeners.length;e<i;e++)try{this.___limitersListeners[e](this)}catch(n){console.warn("Failed while calling value listeners ",n)}}get limiters(){return this.___limiters}set limiters(e){e?this.___limiters=e:delete this.___limiters,this.___updateLimiter()}checkLimit(e){if(this.___limiters){for(let i=0;i<this.___limiters.length;i++)if(this.___limiters[i].func(e))return!1}return!0}checkLimitReason(e){if(this.___limiters)for(let i=0;i<this.___limiters.length;i++){let n=this.___limiters[i];if(n.func(e))if(n.correction)switch(typeof n.reason){case"string":return{allowed:!1,reason:n.reason,correction:n.correction(e)};case"function":return{allowed:!1,reason:n.reason(e),correction:n.correction(e)}}else switch(typeof n.reason){case"string":return{allowed:!1,reason:n.reason};case"function":return{allowed:!1,reason:n.reason(e)}}}return{allowed:!0,reason:""}}set set(e){e===this.___value||!this.checkLimit(e)||(this.___value=e,this.___update())}}class T extends J{constructor(e,i=-1/0,n=1/0,r,a){super(e,a);o(this,"_min");o(this,"_max");o(this,"_step");o(this,"halfStep",0);this._min=i,this._max=n,r&&(this._step=r,this.halfStep=r/2)}get min(){return this._min}set min(e){this._min=e;let i=Math.max(this._min,this.___value);this.___value!==i&&(this.___value=i,this.___update()),this.___updateLimiter()}get max(){return this._max}set max(e){this._max=e;let i=Math.min(this._max,this.___value);this.___value!==i&&(this.___value=i,this.___update()),this.___updateLimiter()}get step(){return this._step}set step(e){if(e){this._step=e,this.halfStep=e/2;let i=this.___value%this._step,n=i>this.halfStep?this.___value+(this._step-i):this.___value-i;n!==this.___value&&(this.___value=n,this.___update())}else delete this._step,this.halfStep=0;this.___updateLimiter()}set set(e){if(this._step){let i=e%this._step;e=i>this.halfStep?e+(this._step-i):e-i}e=Math.min(this._max,Math.max(this._min,e)),e!==this.___value&&this.checkLimit(e)&&(this.___value=e,this.___update())}}class k extends J{constructor(e,i,n,r,a){super(e,a);o(this,"_maxLength");o(this,"_maxByteLength");o(this,"___enums");this._maxLength=n,this._maxByteLength=r,this.___enums=i}get enums(){return this.___enums}set enums(e){if(e){if(this.___enums=e,!this.checkEnum(this.___value))for(const i in this.___enums){this.___value=i,this.___update();return}}else delete this.___enums;this.___updateLimiter()}get enum(){if(this.___enums)return this.___enums[this.___value]}checkEnum(e){return!this.___enums||e in this.___enums}get maxLength(){return this._maxLength}set maxLength(e){this._maxLength=e,this._maxLength&&this.___value.length>this._maxLength&&(this.___value=this.___value.slice(0,this._maxLength),this.___update()),this.___updateLimiter()}get maxByteLength(){return this._maxByteLength}set maxByteLength(e){if(this._maxByteLength=e,this._maxByteLength){let i=G(this.___value,this._maxByteLength);this.___value!==i&&(this.___value=i,this.___update())}this.___updateLimiter()}set set(e){this._maxLength&&e.length>this._maxLength&&(e=e.slice(0,this._maxLength)),this._maxByteLength&&(e=G(e,this._maxByteLength)),e!==this.___value&&this.checkLimit(e)&&this.checkEnum(e)&&(this.___value=e,this.___update())}}var q=Object.defineProperty,W=(s,t,e)=>t in s?q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,L=(s,t,e)=>(W(s,typeof t!="symbol"?t+"":t,e),e);let U={},Y=(s,t,e)=>(U[s]=new M(s,t,e),U[s]);class M{constructor(t,e,i){L(this,"pathID"),L(this,"settings",{}),L(this,"subGroups",{}),L(this,"name"),L(this,"description"),this.pathID=t,this.name=e,this.description=i}makeSubGroup(t,e,i){if(t in this.subGroups){console.warn("Sub group already registered "+t);return}else return this.subGroups[t]=new M(this.pathID+"/"+t,e,i)}makeBooleanSetting(t,e,i,n){if(t in this.settings)throw new Error("Settings already registered "+t);let r=localStorage[this.pathID+"/"+t];if(r)var a=new v(JSON.parse(r));else if(typeof n=="boolean")var a=new v(n);else{var a=new v(!1);n.then(l=>{a.set=l})}return a.info={name:e,description:i},a.addListener(h=>{localStorage[this.pathID+"/"+t]=JSON.stringify(h)},!r),this.settings[t]=a}makeNumberSetting(t,e,i,n,r,a,h,l){if(t in this.settings)throw new Error("Settings already registered "+t);let _=localStorage[this.pathID+"/"+t];if(_)var u=new T(JSON.parse(_),r,a,h,l);else if(typeof n=="number")var u=new T(n,r,a,h,l);else{var u=new T(NaN,r,a,h,l);n.then(E=>{u.set=E})}return u.info={name:e,description:i},u.addListener(x=>{localStorage[this.pathID+"/"+t]=JSON.stringify(x)},!_),this.settings[t]=u}makeStringSetting(t,e,i,n,r,a,h,l){if(t in this.settings)throw new Error("Settings already registered "+t);let _=localStorage[this.pathID+"/"+t];if(_)var u=new k(JSON.parse(_),r,a,h,l);else if(typeof n=="string")var u=new k(n,r,a,h,l);else{var u=new k("",r,a,h,l);n.then(E=>{u.set=E})}return u.info={name:e,description:i},u.addListener(x=>{localStorage[this.pathID+"/"+t]=JSON.stringify(x)},!_),this.settings[t]=u}}let y=Y(V,"Theme/UI","Settings for UI elements and and color themes");class Q{constructor(t,e,i){o(this,"type");o(this,"target");o(this,"data");this.type=t,this.target=e,this.data=i}}class X{constructor(){o(this,"target");o(this,"eventHandler_ListenerStorage",{})}on(t,e){let i=this.eventHandler_ListenerStorage[t];return i?i.indexOf(e)==-1?i.push(e):console.warn("Listener already in handler"):this.eventHandler_ListenerStorage[t]=[e],e}once(t,e){return this.on(t,function(i){return e(i),!0}),e}off(t,e){let i=this.eventHandler_ListenerStorage[t];if(i){let n=i.indexOf(e);n!=-1?i.splice(n,1):console.warn("Listener not in handler")}return e}emit(t,e){let i=this.eventHandler_ListenerStorage[t];if(i&&i.length>0){let n=Object.freeze(new Q(t,this.target||this,e));i.length>1&&(i=[...i]);for(let r=0,a=i.length;r<a;r++)try{i[r](n)&&(i.splice(r,1),a--,r--)}catch(h){console.warn("Failed while dispatching event",h)}}}clear(t){this.eventHandler_ListenerStorage[t]=[]}inUse(t){var e;return Boolean((e=this.eventHandler_ListenerStorage[t])==null?void 0:e.length)}has(t,e){var i;return Boolean(((i=this.eventHandler_ListenerStorage[t])==null?void 0:i.indexOf(e))!==-1)}amount(t){var e;return((e=this.eventHandler_ListenerStorage[t])==null?void 0:e.length)||0}get eventsUserOnly(){return this}}let S=new X,H=S.eventsUserOnly,d=[document],P=document;S.target={documents:d,mainDocument:P};let c=s=>{for(let t=0;t<d.length;t++)s(d[t])},Z=(s,t)=>{if(d.includes(s))console.warn("Document registered twice");else{if(d.push(s),t){let e=P.head.children;for(let i=0;i<e.length;i++)switch(e[i].nodeName){case"LINK":if(e[i].rel!=="stylesheet")break;case"STYLE":s.head.appendChild(e[i].cloneNode(!0));break}}S.emit("documentAdded",s)}},$=s=>{let t=d.indexOf(s);t!=-1?(d.splice(t,1),S.emit("documentRemoved",s)):console.warn("Document not registered")},w={},ee={light:{name:"Light",description:"Don't set touch mode automatically"},dark:{name:"Dark",description:"Change touch mode on first ui interaction"}},m=y.makeStringSetting("theme","Theme","Color theme of UI",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",ee),O=y.makeBooleanSetting("autoTheme","Automatic Theme Change","Toggle for automatically changing theme",!0),te=(s,t,e)=>(w[s]=new N(s,t,e),w[s]);class N{constructor(t,e,i){o(this,"pathID");o(this,"variables",{});o(this,"subGroups",{});o(this,"name");o(this,"description");this.pathID=t,this.name=e,this.description=i}makeSubGroup(t,e,i){if(t in this.subGroups)throw new Error("Sub group already registered "+t);return this.subGroups[t]=new N(this.pathID+"/"+t,e,i)}makeVariable(t,e,i,n,r,a,h){if(t in this.variables)throw new Error("Settings already registered "+t);let l="--"+this.pathID+"/"+t,_=this.variables[l]={name:e,desc:i,vars:{light:n,dark:r}};c(u=>{u.documentElement.style.setProperty(l,_.vars[m.get])})}applyThemes(t,e){for(const i in this.variables)t.setProperty(i,this.variables[i].vars[e]);for(const i in this.subGroups)this.subGroups[i].applyThemes(t,e)}}let B=(s,t)=>{for(const e in w)w[e].applyThemes(s.documentElement.style,t)};m.addListener(s=>{c(t=>{B(t,s)})});window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{O.get&&(m.set=s.matches?"dark":"light")});H.on("documentAdded",s=>{B(s.data,m.get)});c(s=>{B(s,m.get)});let ie={off:{name:"Off",description:"Don't set touch mode automatically"},first:{name:"First Interaction",description:"Change touch mode on first ui interaction"},every:{name:"Every Interaction",description:"Change touch mode on every ui interaction"}},p=y.makeBooleanSetting("touch","Touch Mode","Toggle between touch friendly or mouse friendly UI",!1),g=y.makeStringSetting("autoTouch","Automatic Touch Mode","Mode for automatically changing touch mode","every",ie);p.addListener(s=>{c(t=>{C(t,s)})});g.addListener(s=>{c(t=>{A(t,s)})});let C=(s,t)=>{t?s.documentElement.classList.add("touch"):s.documentElement.classList.remove("touch")},D=s=>{switch(s.pointerType){case"touch":p.set=!0;break;case"mouse":case"pen":default:p.set=!1;break}},I=s=>{D(s),c(t=>{t.documentElement.removeEventListener("pointerdown",I)})},A=(s,t)=>{switch(s.documentElement.removeEventListener("pointerdown",I),s.documentElement.removeEventListener("pointerdown",D),t){case"first":s.documentElement.addEventListener("pointerdown",I,{capture:!0});break;case"every":s.documentElement.addEventListener("pointerdown",D,{capture:!0});break}};H.on("documentAdded",s=>{C(s.data,p.get),A(s.data,g.get)});c(s=>{C(s,p.get),A(s,g.get)});let f=y.makeNumberSetting("scale","UI Scale","The scale of the UI",1,.2,4),b=f.get*16;f.addListener(s=>{b=s*16,c(t=>{t.documentElement.style.fontSize=b+"px"})});H.on("documentAdded",s=>{s.data.documentElement.style.fontSize=b+"px"});c(s=>{s.documentElement.style.fontSize=b+"px"});let F=te(V,"TestVars","TestDescription");F.makeVariable("test","Test Name","Test Description","blue","black","Angle",void 0);F.makeVariable("test2","Test 2 Name","Test 2 Description","test","asdf","Number",{min:0,max:1});let z=s=>{let t=s.body.appendChild(document.createElement("button"));t.innerHTML="Turn Auto Theme Off",t.addEventListener("click",()=>{O.set=!1});let e=s.body.appendChild(document.createElement("button"));e.innerHTML="Turn Auto Theme On",e.addEventListener("click",()=>{O.set=!0});let i=m.enums;for(const l in i){let _=s.body.appendChild(document.createElement("button"));_.innerHTML=l,_.addEventListener("click",()=>{m.set=l})}let n=s.body.appendChild(document.createElement("button"));n.innerHTML="Toggle Touch",n.addEventListener("click",async()=>{p.set=!await p.get});let r=s.body.appendChild(document.createElement("select"));for(const l in g.enums){let _=r.appendChild(document.createElement("option"));_.innerHTML=l}r.addEventListener("change",async l=>{g.set=l.currentTarget.selectedOptions[0].innerHTML}),(async()=>r.value=await g.get)();let a=s.body.appendChild(document.createElement("button"));a.innerHTML="Scale Down",a.addEventListener("click",async()=>{f.set=await f.get-.2});let h=s.body.appendChild(document.createElement("button"));h.innerHTML="Scale Up",h.addEventListener("click",async()=>{f.set=await f.get+.2})};z(document);let R=document.body.appendChild(document.createElement("button"));R.innerHTML="Open Window";R.onclick=()=>{let s=window.open("","","popup");Z(s.document,!0),s==null||s.addEventListener("unload",()=>{$(s.document)}),z(s.document)};
